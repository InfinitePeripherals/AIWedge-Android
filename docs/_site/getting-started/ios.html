<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>iOS - QuantumPay</title> <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>iOS | QuantumPay</title> <meta name="generator" content="Jekyll v4.2.1" /> <meta property="og:title" content="iOS" /> <meta property="og:locale" content="en_US" /> <link rel="canonical" href="http://localhost:4000/getting-started/ios.html" /> <meta property="og:url" content="http://localhost:4000/getting-started/ios.html" /> <meta property="og:site_name" content="QuantumPay" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="iOS" /> <script type="application/ld+json"> {"url":"http://localhost:4000/getting-started/ios.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/logos/quantumpay-dark.png"}},"headline":"iOS","@type":"WebPage","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="http://localhost:4000/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item"><a href="http://localhost:4000/" class="nav-list-link">Home</a></li><li class="nav-list-item active"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/getting-started" class="nav-list-link">Getting Started</a><ul class="nav-list "><li class="nav-list-item active"><a href="http://localhost:4000/getting-started/ios.html" class="nav-list-link active">iOS</a></li><li class="nav-list-item "><a href="http://localhost:4000/getting-started/android.html" class="nav-list-link">Android</a></li><li class="nav-list-item "><a href="http://localhost:4000/getting-started/xamarin.html" class="nav-list-link">Xamarin</a></li></ul></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/api-docs" class="nav-list-link">API Docs</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/api-docs/ios.html" class="nav-list-link">iOS</a></li><li class="nav-list-item "><a href="http://localhost:4000/api-docs/android.html" class="nav-list-link">Android</a></li><li class="nav-list-item "><a href="http://localhost:4000/api-docs/xamarin.html" class="nav-list-link">Xamarin</a></li></ul></li><li class="nav-list-item"><a href="http://localhost:4000/devices" class="nav-list-link">QuantumPay Devices</a></li><li class="nav-list-item"><a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="http://localhost:4000/change-log" class="nav-list-link">Change Log</a><ul class="nav-list "><li class="nav-list-item "><a href="http://localhost:4000/change-log/ios.html" class="nav-list-link">iOS</a></li><li class="nav-list-item "><a href="http://localhost:4000/change-log/android.html" class="nav-list-link">Android</a></li><li class="nav-list-item "><a href="http://localhost:4000/change-log/xamarin.html" class="nav-list-link">Xamarin</a></li></ul></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search QuantumPay" aria-label="Search QuantumPay" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="https://github.com/InfinitePeripherals/QuantumPay" class="site-button" > QuantumPay on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="http://localhost:4000/getting-started">Getting Started</a></li> <li class="breadcrumb-nav-list-item"><span>iOS</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 class="fs-9 no_toc" id="getting-started-with-ios"> <a href="#getting-started-with-ios" class="anchor-heading" aria-labelledby="getting-started-with-ios"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Getting Started with iOS </h1> <p class="fs-5 fw-300">Learn how to set up your iOS app to process payment transactions using QuantumPay.</p><hr /> <details open=""> <summary class="text-delta"> Table of contents </summary> <ol id="markdown-toc"> <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li> <li><a href="#project-setup" id="markdown-toc-project-setup">Project Setup</a> <ol> <li><a href="#adding-the-quantumpay-sdks" id="markdown-toc-adding-the-quantumpay-sdks">Adding the QuantumPay SDKs</a></li> <li><a href="#installing-objectbox" id="markdown-toc-installing-objectbox">Installing ObjectBox</a></li> <li><a href="#turn-off-bitcode-support" id="markdown-toc-turn-off-bitcode-support">Turn off Bitcode support</a></li> <li><a href="#add-mfi-protocols-to-infoplist" id="markdown-toc-add-mfi-protocols-to-infoplist">Add MFi protocols to Info.plist</a></li> <li><a href="#add-privacy-entries-to-infoplist" id="markdown-toc-add-privacy-entries-to-infoplist">Add Privacy entries to Info.plist</a></li> </ol> </li> <li><a href="#processing-a-payment" id="markdown-toc-processing-a-payment">Processing a Payment</a> <ol> <li><a href="#initialize-the-sdks" id="markdown-toc-initialize-the-sdks">Initialize the SDKs</a></li> <li><a href="#create-payment-device" id="markdown-toc-create-payment-device">Create Payment Device</a></li> <li><a href="#create-payment-engine" id="markdown-toc-create-payment-engine">Create Payment Engine</a></li> <li><a href="#setup-handlers" id="markdown-toc-setup-handlers">Setup Handlers</a></li> <li><a href="#connect-to-payment-device" id="markdown-toc-connect-to-payment-device">Connect to Payment Device</a></li> <li><a href="#create-an-invoice" id="markdown-toc-create-an-invoice">Create an Invoice</a></li> <li><a href="#create-a-transaction" id="markdown-toc-create-a-transaction">Create a Transaction</a></li> <li><a href="#start-transaction" id="markdown-toc-start-transaction">Start Transaction</a></li> <li><a href="#transaction-receipt" id="markdown-toc-transaction-receipt">Transaction Receipt</a></li> <li><a href="#disconnect-payment-device" id="markdown-toc-disconnect-payment-device">Disconnect Payment Device</a></li> </ol> </li> <li><a href="#scanning-a-barcode" id="markdown-toc-scanning-a-barcode">Scanning a Barcode</a></li> </ol> </details><hr /> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <div class="code-example"> <ul> <li>SDKs <ul> <li>QuantumPayClient.xcframework</li> <li>QuantumPayMobile.xcframework</li> <li>QuantumPayPeripheral.xcframework</li> <li>QuantumSDK.xcframework</li> <li>ObjectBox <strong>(CocoaPods)</strong></li> </ul> </li> <li>Xcode 11+ / iOS 13+ / Swift 5.0+</li> <li>Infinite Peripherals payment device</li> <li>Infinite Peripherals developer key for your app bundle ID</li> <li>Payment related credentials: username/email, password, service name and tenant key</li> </ul> </div> <p><strong>*If you are missing any of these items, please contact Infinite Peripherals</strong></p><hr /> <h2 id="project-setup"> <a href="#project-setup" class="anchor-heading" aria-labelledby="project-setup"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Project Setup </h2> <p>Before we jump into the code we need to make sure your Xcode project is properly configured to use the QuantumPay frameworks. Follow the steps below to get you set up.</p> <h3 id="adding-the-quantumpay-sdks"> <a href="#adding-the-quantumpay-sdks" class="anchor-heading" aria-labelledby="adding-the-quantumpay-sdks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Adding the QuantumPay SDKs </h3> <ol> <li> <p>Open Xcode and create a new folder to put the frameworks in. If you have a place for frameworks already you can skip this.</p> </li> <li> <p>Drag the QuantumPay frameworks into your folder.</p> </li> </ol> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-1.png" style="border:1px solid #000000" /> </p> <ol> <li>Make sure when prompted you enable “Copy items if needed”.</li> </ol> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-2.png" style="border:1px solid #000000" /> </p> <ol> <li>Go to your project’s General tab and scroll down to the <strong>Frameworks, Libraries and Embedded Content</strong> section. For each framework we just added set the <strong>Embed</strong> field to “Embed &amp; Sign”.</li> </ol> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-3.png" style="border:1px solid #000000" /> </p> <h3 id="installing-objectbox"> <a href="#installing-objectbox" class="anchor-heading" aria-labelledby="installing-objectbox"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Installing ObjectBox </h3> <ol> <li> <p>In order to use the QuantumPay frameworks you will need to add ObjectBox to your project. Visit <a href="https://swift.objectbox.io">ObjectBox</a> and follow the instructions to install ObjectBox to your project.</p> </li> <li> <p>If your project is not using CocoaPods yet, it may be more helpful to start here <a href="https://swift.objectbox.io/install#detailed-instructions">ObjectBox - Detailed Instructions</a></p> </li> </ol> <h3 id="turn-off-bitcode-support"> <a href="#turn-off-bitcode-support" class="anchor-heading" aria-labelledby="turn-off-bitcode-support"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Turn off Bitcode support </h3> <p>Go to your project’s Build Settings tab and set <strong>Enable Bitcode</strong> to “No”. The easiest way to find this setting is to use the search field in the top right.</p> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-4.png" style="border:1px solid #000000" /> </p> <h3 id="add-mfi-protocols-to-infoplist"> <a href="#add-mfi-protocols-to-infoplist" class="anchor-heading" aria-labelledby="add-mfi-protocols-to-infoplist"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Add MFi protocols to Info.plist </h3> <p>Go to your project’s <strong>Info.plist</strong> file and add a new entry for “Supported external accessory protocols” using the following values. Note: in Xcode 13.0+ this has been moved to the “Info” tab in your project’s settings.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>com.datecs.pengine
com.datecs.linea.pro.msr
com.datecs.linea.pro.bar
com.datecs.printer.escpos
com.datecs.pinpad
</code></pre></div></div> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-5.png" style="border:1px solid #000000" /> </p> <h3 id="add-privacy-entries-to-infoplist"> <a href="#add-privacy-entries-to-infoplist" class="anchor-heading" aria-labelledby="add-privacy-entries-to-infoplist"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Add Privacy entries to Info.plist </h3> <p>Also in your project’s <strong>Info.plist</strong> file we need to add the four (4) privacy tags listed below. You can enter any string value you want or copy what we have below. Note: in Xcode 13.0+ this has been moved to the “Info” tab in your project’s settings.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"Privacy - Bluetooth Always Usage Description" 
"Privacy - Bluetooth Peripheral Usage Description"
"Privacy - Location When In Use Usage Description" 
"Privacy - Location Usage Description"
</code></pre></div></div> <p align="center"> <img src="https://www.infineadev.com/lucas/qpay/ios-6.png" style="border:1px solid #000000" /> </p><hr /> <h2 id="processing-a-payment"> <a href="#processing-a-payment" class="anchor-heading" aria-labelledby="processing-a-payment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Processing a Payment </h2> <p>At this point, your Xcode project should be configured and ready to use the QuantumPay libraries. This next section will take you through some initial setup all the way to processing a payment.</p> <h3 id="initialize-the-sdks"> <a href="#initialize-the-sdks" class="anchor-heading" aria-labelledby="initialize-the-sdks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Initialize the SDKs </h3> <p>First, initialize the SDKs with valid keys provided by Infinite Peripherals. This is a required step before you are able to use other functions from the SDKs. If you do not have these keys yet, please contact Infinite Peripherals.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Create tenant</span>
<span class="k">let</span> <span class="nv">tenant</span> <span class="o">=</span> <span class="kt">Tenant</span><span class="p">(</span><span class="nv">hostKey</span><span class="p">:</span> <span class="s">"Host key"</span><span class="p">,</span> <span class="nv">tenantKey</span><span class="p">:</span> <span class="s">"Tenant key"</span><span class="p">)</span>

<span class="c1">// Initialize QuantumPay</span>
<span class="kt">InfinitePeripherals</span><span class="o">.</span><span class="nf">initialize</span><span class="p">(</span><span class="nv">developerKey</span><span class="p">:</span> <span class="s">"Developer key"</span><span class="p">,</span> <span class="nv">tenant</span><span class="p">:</span> <span class="n">tenant</span><span class="p">)</span>
</code></pre></div></div> <h3 id="create-payment-device"> <a href="#create-payment-device" class="anchor-heading" aria-labelledby="create-payment-device"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create Payment Device </h3> <p>Now initialize a payment device that matches the hardware you are using. The current supported payment devices are: QPC150, QPC250, QPP400, QPP450, QPR250, QPR300. Note that this step is different for payment devices that are connected with Bluetooth LE.</p> <ul> <li>Initialize QPC150, QPC250 (Lightning connector)</li> </ul> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">paymentDevice</span> <span class="o">=</span> <span class="kt">QPC250</span><span class="p">()</span>
</code></pre></div></div> <ul> <li>Initialize QPP400, QPP450, QPR250, QPR300 (Bluetooth LE) by supplying its serial number so the <code class="language-plaintext highlighter-rouge">PaymentEngine</code> can search for and connect to it. On first connection, the app will prompt you to pair the device. Be sure to press “OK” when the pop-up is shown. To complete the pairing, if using a QPR device, press the small button on top of the device opposite the power button. If using a QPP device, press the green check mark button on the bottom right of the keypad.</li> </ul> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The device serial number is found on the label on the device.</span>
<span class="k">let</span> <span class="nv">paymentDevice</span> <span class="o">=</span> <span class="kt">QPR250</span><span class="p">(</span><span class="nv">serial</span><span class="p">:</span> <span class="s">"2320900026"</span><span class="p">)</span> 
</code></pre></div></div> <h3 id="create-payment-engine"> <a href="#create-payment-engine" class="anchor-heading" aria-labelledby="create-payment-engine"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create Payment Engine </h3> <p>The payment engine is the main object that you will interact with to send transactions and receive callbacks.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">do</span> <span class="p">{</span>
    <span class="k">try</span> <span class="kt">PaymentEngine</span><span class="o">.</span><span class="nf">builder</span><span class="p">()</span>
        <span class="c1">// Set server environment to either test or production</span>
        <span class="o">.</span><span class="nf">server</span><span class="p">(</span><span class="nv">server</span><span class="p">:</span> <span class="kt">ServerEnvironment</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="c1">// Credentials used to register hardware devices</span>
        <span class="o">.</span><span class="nf">registrationCredentials</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="s">"username"</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"password"</span><span class="p">)</span>
        <span class="c1">// Using the device we created earlier, set the peripheral and capabilities</span>
        <span class="c1">// Capabilities are the card input methods (e.g.: Mag stripe, contactless, chip). If you don't want the full array of capabilities provided by the device object, you can pass an array of select input methods only.</span>
        <span class="o">.</span><span class="nf">addPeripheral</span><span class="p">(</span><span class="nv">peripheral</span><span class="p">:</span> <span class="n">paymentDevice</span><span class="p">,</span> <span class="nv">capabilities</span><span class="p">:</span> <span class="n">paymentDevice</span><span class="o">.</span><span class="n">availableCapabilities</span><span class="o">!</span><span class="p">,</span> <span class="nv">autoConnect</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
        <span class="c1">// The Point of Sale ID of the device/app. This posID should be unique for each instance of the app. This is used by the database to access saved transactions.</span>
        <span class="o">.</span><span class="nf">posID</span><span class="p">(</span><span class="nv">posID</span><span class="p">:</span> <span class="s">"posId"</span><span class="p">)</span>
        <span class="c1">// Amount of time after transaction has started to wait for card to be presented</span>
        <span class="o">.</span><span class="nf">transactionTimeout</span><span class="p">(</span><span class="nv">timeoutInSeconds</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
        <span class="c1">// StoreAndForwardMode for submitting transactions to server</span>
        <span class="o">.</span><span class="nf">storeAndForward</span><span class="p">(</span><span class="nv">mode</span><span class="p">:</span> <span class="o">.</span><span class="n">whenOffline</span><span class="p">,</span> <span class="nv">autoUploadInterval</span><span class="p">:</span> <span class="mi">60</span><span class="p">)</span>
        <span class="c1">// If this build function is successful, the PaymentEngine will be passed in the completion block.</span>
        <span class="o">.</span><span class="nf">build</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">in</span>
            <span class="c1">// Save the created engine object</span>
            <span class="k">self</span><span class="o">.</span><span class="n">pEngine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="p">})</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">{</span>
    <span class="nf">print</span><span class="p">(</span><span class="s">"Error creating payment engine: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="setup-handlers"> <a href="#setup-handlers" class="anchor-heading" aria-labelledby="setup-handlers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Setup Handlers </h3> <p>Once the <code class="language-plaintext highlighter-rouge">PaymentEngine</code> is created, you can use it’s handlers to track the operation. The <code class="language-plaintext highlighter-rouge">PaymentEngine</code> handlers will get called throughout the payment process and will return you the current state of the transaction. You can set these handlers in the completion block of the previous step.</p> <p><code class="language-plaintext highlighter-rouge">ConnectionStateHandler</code> will get called when the connection state of the payment device changes between connecting, connected, and disconnected. It is important to make sure your device is connected before attempting to start a transaction.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">setConnectionStateHandler</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">peripheral</span><span class="p">,</span> <span class="n">connectionState</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle connection state</span>
<span class="p">})</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">TransactionResultHandler</code> will get called after the transaction is processed. The <code class="language-plaintext highlighter-rouge">TransactionResult</code> status will disclose whether the transaction was approved or declined.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">setTransactionResultHandler</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">transactionResult</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle the transaction result</span>
    <span class="c1">// transactionResult.status provides the transaction result</span>
    <span class="c1">// transactionResult.receipt provides the online receipt when transactionResult.state == .approved</span>
<span class="p">})</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">TransactionStateHandler</code> will get called when the transaction state changes. The <code class="language-plaintext highlighter-rouge">TransactionState</code> represents a unique state in the workflow of capturing a transaction. These include “waitingForCard, waitingForPin, onlineAuthorization, etc.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">setTransactionStateHandler</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">peripheral</span><span class="p">,</span> <span class="n">transaction</span><span class="p">,</span> <span class="n">transactionState</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle transaction state</span>
<span class="p">})</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">PeripheralStateHandler</code> will get called when the state of the peripheral changes during the transaction process. The <code class="language-plaintext highlighter-rouge">PeripheralState</code> represents the current state of the peripheral as reported by the peripheral device itself. These include “idle”, “ready”, “contactCardInserted” etc.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">setPeripheralStateHandler</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">peripheral</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle peripheral state</span>
<span class="p">})</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">PeripheralMessageHandler</code> will get called when there is new message about the transaction throughout the process. The peripheral message tells you when to present the card, if the card read is successful or failed, etc. This usually indicates something that should be displayed in the user interface.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">setPeripheralMessageHandler</span><span class="p">(</span><span class="nv">handler</span><span class="p">:</span> <span class="p">{</span> <span class="p">(</span><span class="n">peripheral</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle peripheral message</span>
<span class="p">})</span>
</code></pre></div></div> <h3 id="connect-to-payment-device"> <a href="#connect-to-payment-device" class="anchor-heading" aria-labelledby="connect-to-payment-device"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Connect to Payment Device </h3> <p>Now that your payment engine is configured and your handlers are set up, lets connect to the payment device. Please make sure the device is attached and turned on. We need to connect to the payment device prior to starting a transaction. The connection state will be returned to the <code class="language-plaintext highlighter-rouge">ConnectionStateHandler</code> that we set up previously. If you didn’t set autoConnect when creating the payment engine, you will need to call <code class="language-plaintext highlighter-rouge">connect()</code> before starting a transaction.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">connect</span><span class="p">()</span>
</code></pre></div></div> <h3 id="create-an-invoice"> <a href="#create-an-invoice" class="anchor-heading" aria-labelledby="create-an-invoice"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create an Invoice </h3> <p>Time to create an invoice. This invoice object holds information about a purchase order and the items in the order.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">invoice</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!</span>
                    <span class="c1">// Build invoice with a reference number. This can be anything.</span>
                    <span class="o">.</span><span class="nf">buildInvoice</span><span class="p">(</span><span class="nv">reference</span><span class="p">:</span> <span class="n">invoiceNum</span><span class="p">)</span>
                    <span class="c1">// Set company name</span>
                    <span class="o">.</span><span class="nf">companyName</span><span class="p">(</span><span class="nv">companyName</span><span class="p">:</span> <span class="s">"ACME SUPPLIES INC."</span><span class="p">)</span>
                    <span class="c1">// Set purchase order reference. This can be anything to identify the order.</span>
                    <span class="o">.</span><span class="nf">purchaseOrderReference</span><span class="p">(</span><span class="nv">reference</span><span class="p">:</span> <span class="s">"P01234"</span><span class="p">)</span>
                    <span class="c1">// A way to add item to the invoice</span>
                    <span class="o">.</span><span class="nf">addItem</span><span class="p">(</span><span class="nv">productCode</span><span class="p">:</span> <span class="s">"SKU1"</span><span class="p">,</span> <span class="nv">description</span><span class="p">:</span> <span class="s">"Discount Voucher for Return Visit"</span><span class="p">,</span> <span class="nv">unitPrice</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="c1">// Another way to add item to the invoice</span>
                    <span class="o">.</span><span class="n">addItem</span> <span class="p">{</span> <span class="p">(</span><span class="n">itemBuilder</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">InvoiceItemBuilder</span> <span class="k">in</span>
                        <span class="k">return</span> <span class="n">itemBuilder</span>
                            <span class="o">.</span><span class="nf">productCode</span><span class="p">(</span><span class="s">"SKU2"</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">productDescription</span><span class="p">(</span><span class="s">"In Store Item"</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">saleCode</span><span class="p">(</span><span class="kt">SaleCode</span><span class="o">.</span><span class="kt">S</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">unitPrice</span><span class="p">(</span><span class="mf">1.00</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">quantity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">unitOfMeasureCode</span><span class="p">(</span><span class="o">.</span><span class="kt">Each</span><span class="p">)</span>
                            <span class="o">.</span><span class="nf">calculateTotals</span><span class="p">()</span>
                    <span class="p">}</span>
                    <span class="c1">// Calculate totals on the invoice</span>
                    <span class="o">.</span><span class="nf">calculateTotals</span><span class="p">()</span>
                    <span class="c1">// Builds invoice instance with the provided values</span>
                    <span class="o">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre></div></div> <h3 id="create-a-transaction"> <a href="#create-a-transaction" class="anchor-heading" aria-labelledby="create-a-transaction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Create a Transaction </h3> <p>The transaction object holds information about the invoice, the total amount for the transaction and the type of the transaction (e.g.: sale, auth, refund, etc.)</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">transaction</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">buildTransaction</span><span class="p">(</span><span class="nv">invoice</span><span class="p">:</span> <span class="n">invoice</span><span class="p">)</span>
                        <span class="c1">// The transaction is of type Sale</span>
                        <span class="o">.</span><span class="nf">sale</span><span class="p">()</span>
                        <span class="c1">// The total amount of for all invoices</span>
                        <span class="o">.</span><span class="nf">amount</span><span class="p">(</span><span class="mf">1.00</span><span class="p">,</span> <span class="nv">currency</span><span class="p">:</span> <span class="o">.</span><span class="kt">USD</span><span class="p">)</span>
                        <span class="c1">// A unique reference to the transaction. This cannot be reused.</span>
                        <span class="o">.</span><span class="nf">reference</span><span class="p">(</span><span class="s">"A reference to this transaction"</span><span class="p">)</span>
                        <span class="c1">// Date and time of the transaction</span>
                        <span class="o">.</span><span class="nf">dateTime</span><span class="p">(</span><span class="kt">Date</span><span class="p">())</span>
                        <span class="c1">// The service code generated by Infinite Peripherals</span>
                        <span class="o">.</span><span class="nf">service</span><span class="p">(</span><span class="s">"service"</span><span class="p">)</span>
                        <span class="c1">// Some information about the transaction that you want to add</span>
                        <span class="o">.</span><span class="nf">metaData</span><span class="p">([</span><span class="s">"orderNumber"</span> <span class="p">:</span> <span class="n">invoiceNum</span><span class="p">,</span> <span class="s">"delivered"</span> <span class="p">:</span> <span class="s">"true"</span><span class="p">])</span>
                        <span class="c1">// Build the transaction</span>
                        <span class="o">.</span><span class="nf">build</span><span class="p">()</span>
</code></pre></div></div> <h3 id="start-transaction"> <a href="#start-transaction" class="anchor-heading" aria-labelledby="start-transaction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Start Transaction </h3> <p>Now that everything is ready we can start the transaction and take payment. Watch the handler messages and status updates to track the transaction throughout the process.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">startTransaction</span><span class="p">(</span><span class="nv">transaction</span><span class="p">:</span> <span class="n">txn</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">transactionResult</span><span class="p">,</span> <span class="n">transactionResponse</span><span class="p">)</span> <span class="k">in</span>
    <span class="c1">// Handle the transaction result and response</span>
    <span class="c1">// transactionResult.status discloses the state of the transaction after being processed. See `TransactionResultStatus` for more info.</span>
    <span class="c1">// transactionResponse discloses the server's response for the submitted transaction. If an error occurs, the object will contain the</span>
    <span class="c1">// error's information. See `TransactionResponse` for more info.</span>
    <span class="c1">// ....</span>
<span class="p">}</span>
</code></pre></div></div> <h3 id="transaction-receipt"> <a href="#transaction-receipt" class="anchor-heading" aria-labelledby="transaction-receipt"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Transaction Receipt </h3> <p>Once the transaction is completed and approved, the receipt is sent to the <code class="language-plaintext highlighter-rouge">TransactionResultHandler</code> callback.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// The url for customer receipt</span>
<span class="n">transactionResult</span><span class="o">.</span><span class="n">receipt</span><span class="p">?</span><span class="o">.</span><span class="n">customerReceiptUrl</span>

<span class="c1">// The url for merchant receipt</span>
<span class="n">transactionResult</span><span class="o">.</span><span class="n">receipt</span><span class="p">?</span><span class="o">.</span><span class="n">merchantReceiptUrl</span>
</code></pre></div></div> <h3 id="disconnect-payment-device"> <a href="#disconnect-payment-device" class="anchor-heading" aria-labelledby="disconnect-payment-device"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Disconnect Payment Device </h3> <p>Now that the transaction is complete you are free to disconnect the payment device if you wish. Please note that this should not be called before or during the transaction process.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">self</span><span class="o">.</span><span class="n">pEngine</span><span class="o">!.</span><span class="nf">disconnect</span><span class="p">()</span>
</code></pre></div></div><hr /> <h2 id="scanning-a-barcode"> <a href="#scanning-a-barcode" class="anchor-heading" aria-labelledby="scanning-a-barcode"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scanning a Barcode </h2> <p>Some of our payment devices also support barcode scanning (e.g., QPC150, QPC250). In order to receive the barcode data, you will need to set your class to conform to the protocol <code class="language-plaintext highlighter-rouge">IPCDTDeviceDelegate</code> and add the class instance as a delegate that will receive the data when scanned. Note that the scan button will not work if it is not properly connected to the application.</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Add class instance as delegate</span>
<span class="k">self</span><span class="o">.</span><span class="n">paymentDevice</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="nf">addDelegate</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
</code></pre></div></div> <p>Once a barcode is scanned, it will be sent to this delegate method:</p> <div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">barcodeData</span><span class="p">(</span><span class="n">_</span> <span class="nv">barcode</span><span class="p">:</span> <span class="kt">String</span><span class="o">!</span><span class="p">,</span> <span class="nv">type</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle the barcode</span>
<span class="p">}</span>
</code></pre></div></div> <hr> <footer> <p><a href="#top" id="back-to-top">Back to top</a></p> <p class="text-small text-grey-dk-100 mb-0">Copyright &copy; 2021 Infinite Peripherals Inc. Distributed by an <a href="https://google.com">___ license.</a></p> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
